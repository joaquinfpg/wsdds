<div id="chat-container" class="mt-4">
  <h5>AI Chat</h5>
  <div id="chat-messages" class="mb-3" style="height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 10px;"></div>
  <div class="input-group">
    <input type="text" id="chat-input" class="form-control" placeholder="Type your message...">
    <button class="btn btn-primary" id="send-btn">Send</button>
  </div>
</div>

<script>
let chatMessages = [];

document.getElementById('send-btn').addEventListener('click', function() {
  const input = document.getElementById('chat-input');
  const message = input.value.trim();
  if (!message) return;

  // Add user message
  chatMessages.push({role: 'user', content: message});
  addMessage('You: ' + message);

  // Send to server
  console.log('Sending messages:', chatMessages);
  fetch('/chat/send', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ messages: chatMessages })
  })
  .then(response => {
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    return response.json();
  })
  .then(data => {
    console.log('Received data:', data);
    if (data.response && data.response.trim() && data.response.toLowerCase() !== 'undefined') {
      chatMessages.push({role: 'assistant', content: data.response});
      addMessage('AI: ' + data.response);
    } else if (data.error) {
      addMessage('Error: ' + data.error);
    } else {
      addMessage('AI: I\'m here to help! How can I assist you today?');
    }
  })
  .catch(error => {
    console.log('Fetch error:', error);
    addMessage('Error: ' + (error.message || 'Unknown error'));
  });

  input.value = '';
});

function addMessage(text) {
  const messagesDiv = document.getElementById('chat-messages');
  const p = document.createElement('p');
  p.textContent = text;
  messagesDiv.appendChild(p);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}
</script>